{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EducMin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200..800&family=Freeman&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{% static 'scripts/tailwind.js' %}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                clifford: '#da373d',
                primary: '#ff7e84',
                secondary: '#30bead',
                tertiary: '#ffbc1f',
                redShade: '#8861db',
                dark: '#0c1327',
                fourth: '#dcf2ef',
                fiveth: '#ffebec',
                sixth: '#ffffff'
              },
              flex: {
                '30': '1 1 30rem'
              },
              gridTemplateColumns: {
                'auto-fit': 'repeat(auto-fit, minmax(250px, 1fr))',
              },
              screens: {
                'max-950': {'max': '950px'},
                'max-700': {'max': '700px'},
                'max-635': {'max': '635px'},
                'max-585': {'max': '585px'},
                'max-495': {'max': '495px'},
                'max-395': {'max': '395px'},
                'min-895': '895px'
              },
              spacing: {
                '10p': '10%',
              },
              height: {
                '90': '90%',
                '110': '110vh'
              },
              width: {
                '90': '90%',
                '110': '110vh'
              },
            }
          }
        }
    </script>
</head>
<body>
    <nav class="fixed z-50 w-full p-2 flex items-center justify-around bg-white max-700:justify-between">
        <span class="text-black-600 text-2xl font-bold max-700:text-xl">EduMim</span>
        <ul id="nav" class="flex items-center justify-between gap-8 text-lg text-gray-600 font-semibold max-700:text-base max-585:bg-gray-200 max-585:w-3/4
         max-585:rounded max-585:p-8 max-585:flex-col max-585:absolute max-585:top-16 max-585:left-10p max-585:hidden">
         <li>
          <a class="hover:text-primary hover:font-bold" href="{% url 'student:index' %}">Accueil</a>
          </li>
          <li>
              <a class="hover:text-primary hover:font-bold" href="{% url 'student:matieres' %}">Matières</a>
          </li>
          <li>
              <a class="hover:text-primary hover:font-bold" href="{% url 'student:cours' %}">Cours</a>
          </li>
          <li>
              <a class="text-primary font-bold hover:text-primary hover:font-bold" href="{% url 'student:exercices' %}">Exercices</a>
          </li>
        </ul>
        <div class="flex items-center justify-center gap-5 max-700:gap-3">
          <div class="flex items-center gap-4">
            {% if student.image %}
              <img id="profile" class="w-12 h-12 p-1 rounded-full ring-2 ring-gray-300 object-cover" src="{{ student.image.url }}" alt="profile">
            {% else %}
              <img id="profile" class="w-12 h-12 p-1 rounded-full ring-2 ring-gray-300 object-cover" src="{% static 'img/profile.jpg' %}" alt="profile">
            {% endif %}
          </div>
          <div class="fa-solid fa-bars text-3xl cursor-pointer hidden max-585:block" id="menu-bar"></div>
          <div id="info" class="hidden w-1/5 p-4 flex items-center justify-center flex-col gap-2 rounded-lg bg-gray-100 absolute top-20 drop-shadow-2xl before:w-5 before:h-5 before:bg-gray-100 before:absolute before:-top-2 before:inset-x-auto before:rotate-45 max-950:before:right-10 max-950:w-1/3 max-950:right-10 max-585:w-1/2 max-585:before:inset-x-auto max-395:w-3/4 max-395:right-1">
            <a href="{% url 'student:profile' %}" class="w-full p-2 border-b border-solid border-gray-300 rounded-lg text-lg font-semibold transition duration-300 ease-in-out hover:bg-primary hover:text-white">Voir mon profile</a>
            <a href="{% url 'student:logout' %}" class="w-full p-2 rounded-lg text-lg font-semibold transition duration-300 ease-in-out hover:bg-primary hover:text-white">Deconnexion</a>
          </div>
        </div>
    </nav>
    
    <section class="w-full h-screen z-40 py-8 px-32 bg-gradient-to-r from-fourth to-fiveth flex items-center justify-center flex-col gap-4 max-950:px-4">
      <span class="mt-8 text-3xl text-primary underline font-bold max-700:text-xl max-395:text-lg">{{ data.titre }}</span>
      <div class="w-3/6 p-4 bg-white flex items-center justify-center flex-col gap-8 rounded max-700:w-5/6 max-395:w-full">  
        <div id="container" class="w-full flex items-start justify-center flex-col gap-4">
          <div class="border-b border-solid border-gray-500 w-full pl-0 p-2">
            <span id="num-question" class="text-2xl text-dark font-bold max-495:text-xl">Question 1</span>
          </div>
          <p id="question" class="pl-2 text-xl text-gray-800 font-semibold max-495:text-lg">Une API est...</p>
          <div class="pl-2 w-full flex items-start justify-center flex-col gap-2">
            <div class="flex items-center">
              <input id="a" name="answer" type="radio" class="w-4 h-4 text-blue-600 border-none bg-blue-100 border-gray-100 rounded focus:ring-blue-500 answer">
              <label id="a-text" for="a" class="ms-2 text-xl font-light text-gray-800 max-495:text-sm">None</label>
            </div>
            <div class="flex items-center">
              <input name="answer" id="b" type="radio" class="w-4 h-4 text-blue-600 bg-blue-100 border-gray-100 rounded focus:ring-blue-500 answer">
              <label id="b-text" for="b" class="ms-2 text-xl font-light text-gray-800 max-495:text-sm">None</label>
            </div>
            <div class="flex items-center">
              <input name="answer" id="c" type="radio" class="w-4 h-4 text-blue-600 bg-blue-100 border-gray-100 rounded focus:ring-blue-500 answer">
              <label id="c-text" for="c" class="ms-2 text-xl font-light text-gray-800 max-495:text-sm">None</label>
            </div>
          </div>
          <button id="next" class="self-center bg-secondary w-full p-4 rounded-lg text-xl text-white font-bold transition ease-in-out duration-300 hover:scale-90 max-495:p-2 max-495:text-base">Suivant</button>
        </div>  
        <form id="form" class="w-full hidden p-4 flex items-center justify-center flex-col gap-4" method="post" action="{% url 'student:score' data.id %}">
          {% csrf_token %}
          <p class="text-2xl text-dark font-bold">Vous avez obtenu un score de <span id="score" class="text-secondary">08/10</span></p>
          <input name="user-score" id="user-score" class="hidden" type="text">
          <button id="verification" class="self-center bg-secondary w-full p-2 rounded-lg text-xl text-white font-bold transition ease-in-out duration-300 hover:scale-90 max-495:p-2 max-495:text-base">Soumettre</button>
        </form>
      </div>
    </section>
    
    <footer class="w-full py-16 px-32 bg-dark flex items-center justify-center flex-wrap max-950:px-4">
      <div class="p-2 w-full grid grid-cols-1 gap-4 justify-between md:grid-cols-3">
        <div class="p-4 flex items-start justify-center flex-col gap-4">
          <span class="text-3xl text-white font-bold">EduMin</span>
          <p class="text-xm text-gray-600 font-medium text-justify max-700:text-lg max-585:text-base max-495:text-sm max-395:text-xs">
            "L'éducation est l'arme la plus puissante
            que vous pouvez utilisez pour changer le monde."
            --Nelson Mandela
          </p>
          <div class="p-4 w-3/4 flex items-center justify-between gap-2">
            <div class="fa-brands fa-facebook-f flex items-center justify-center text-xl text-white w-10 h-10 p-2 bg-gray-700 rounded transition ease-in-out duration-300 hover:bg-primary"></div>
            <div class="fa-brands fa-instagram flex items-center justify-center text-xl text-white w-10 h-10 p-2 bg-gray-700 rounded transition ease-in-out duration-300 hover:bg-primary"></div>
            <div class="fa-brands fa-twitter flex items-center justify-center text-xl text-white w-10 h-10 p-2 bg-gray-700 rounded transition ease-in-out duration-300 hover:bg-primary"></div>
            <div class="fa-brands fa-linkedin-in flex items-center justify-center text-xl text-white w-10 h-10 p-2 bg-gray-700 rounded transition ease-in-out duration-300 hover:bg-primary"></div>
          </div>
        </div>
        <div class="p-4 flex items-start justify-start flex-col gap-4">
          <span class="text-xl text-white font-bold max-395:text-base">Links</span>
          <a href="{% url 'student:index' %}" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Home</a>
          <a href="{% url 'student:matieres' %}" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Matiers</a>
          <a href="{% url 'student:cours' %}" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Cours</a>
          <a href="{% url 'student:exercices' %}" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Exercices</a>
          
        </div>
        <div class="p-4 flex items-start justify-start flex-col gap-4">
          <span class="text-xl text-white font-bold max-395:text-base">Legal</span>
          <a href="#" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Tearm & Condition</a>
          <a href="#" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Payement Method</a>
          <a href="#" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Privacy Policy</a>
          <a href="#" class="text-lg text-gray-600 font-medium transition ease-in-out duration-300 transform hover:translate-x-1 hover:underline hover:text-primary max-395:text-sm">Licensencing</a>
        </div>
      </div>
      
    </footer>

    {{ data.questions|json_script:"data" }}

    <script src="{% static 'js/scripts.js' %}"></script>

    <script>
      const parseAnswer = JSON.parse(document.getElementById('data').textContent);
        const container = document.getElementById('container');
        const next = document.getElementById('next');
        const answer = document.querySelectorAll('.answer');
        const a_text = document.getElementById('a-text');
        const b_text = document.getElementById('b-text');
        const c_text = document.getElementById('c-text');
        const inputA = document.getElementById('a');
        const inputB = document.getElementById('b');
        const inputC = document.getElementById('c');
        const question = document.getElementById('question');
        const numQuestion = document.getElementById('num-question');
        const form = document.getElementById("form");
        const userScore = document.getElementById("score");
        const inputScore = document.getElementById("user-score");
        const info = document.getElementById('info');
        const profile = document.getElementById('profile');

        profile.addEventListener('click', () => {
          info.classList.toggle('hidden');
        });

        let score = 0;
        let i = 0;

        const loadQuestion = () => {
            deselectAnswer();
            numQuestion.textContent = `Question ${i + 1}`;
            question.textContent = parseAnswer[i].text;
            a_text.textContent = parseAnswer[i].choix[0].choix;
            b_text.textContent = parseAnswer[i].choix[1].choix;
            c_text.textContent = parseAnswer[i].choix[2].choix;
            inputA.textContent = parseAnswer[i].choix[0].choix;
            inputB.textContent = parseAnswer[i].choix[1].choix;
            inputC.textContent = parseAnswer[i].choix[2].choix;
        } 

        const deselectAnswer = () => {
            answer.forEach(el => {
                el.checked = false;
            })
        }

        const getSelected = () => {
            let id;
            answer.forEach(el => {
                if(el.checked)
                    id = el.id;
            })

            return id;
        }

        loadQuestion();

        next.addEventListener('click', () => {
            const ans = document.getElementById(getSelected());
            
            if(ans) {

                parseAnswer[i].choix.forEach(el => {
                    if(el.est_correcte && el.choix == ans.textContent)
                        score++;
                })

                
                i++;
                if(i < parseAnswer.length) {
                  loadQuestion();
                } else {
                    container.classList.add('hidden');
                    form.classList.remove('hidden');
                    inputScore.value = score
                    userScore.textContent = `${score}/${parseAnswer.length}` ; 
                }
            }
        })
    </script>
</body>
</html>